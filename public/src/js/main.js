let audio=undefined;let imgSkills={coop:"src/img/skills_icon_aviculture.png",apiary:"src/img/skills_icon_beekeeping.png",mine:"src/img/skills_icon_mining.png",sluggery:"src/img/skills_icon_slugger.png"};window.addEventListener("beforeunload",(function(e){e.preventDefault();e.returnValue="Espera, no cierres esta p치gina. Si lo haces, el contador se perder치."}));document.addEventListener("DOMContentLoaded",(function(){const input=document.getElementById("lands");const button=document.getElementById("exploreButton");function toggleButtonState(){if(input.value.trim()!==""){button.disabled=false;button.classList.add("is-primary");button.classList.remove("is-disabled")}else{button.disabled=true;button.classList.remove("is-primary");button.classList.add("is-disabled")}if(input.value<1||input.value>5e3||isNaN(input.value)){input.value="";button.disabled=true;button.classList.remove("is-primary");button.classList.add("is-disabled")}}input.addEventListener("input",toggleButtonState);toggleButtonState()}));function exploreLand(){console.log("entro en exploreLand()");let landNumber=document.getElementById("lands").value;let option={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({landNumber:landNumber})};fetch(`/exploreLands`,option).then((response=>response.json())).then((data=>{if(data.message){renderLands(data.message);renderSaveBtn(data.message)}else if(data.error){alert(data.error)}})).catch((error=>{console.error("Error:",error);alert("Hubo un error al explorar el terreno.")}))}function renderLands(data){data=JSON.parse(data);if(!data.prevLand||!data.land||!data.nextLand){console.error("Data is missing one or more required fields");return}const prevLandsTab=document.getElementById("prevLandsTab");const currentLandsTab=document.getElementById("currentLandsTab");const nextLandsTab=document.getElementById("nextLandsTab");function createLandContent(land,title){return`\n                <h3 class="body-content"> \n                <a href="#" class="nes-badge is-splited">\n                 <span class="is-dark">${title}</span>\n                 <span class="${land.is_open?"is-success":"is-error"}">#${land.number}</span>\n                </a>\n                </h3>\n                <h2>\n                    <i class="fa fa-home" aria-hidden="true"></i>\n                    Farm and Resource\n                </h2>\n                <div class="nes-table-responsive">\n                    <table class="nes-table is-bordered is-centered table-centered">\n                        <thead>\n                            <tr>\n                                <th>Chicken Coop</th>\n                                <th>Apiary</th>\n                                <th>Farming</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            <tr>\n                                <td>\n                                    <a href="#" class="nes-badge is-splited custom-badge">\n                                        <span class="is-dark">have</span>\n                                        <span class="${land.coop?"is-success":"is-error"}">${land.coop?"Yes":"No"}</span>\n                                    </a>\n                                    <img class="img-table ${land.coop?"":"grayscale"}" src="src/img/coop.png" />\n                                </td>\n                                <td>\n                                    <a href="#" class="nes-badge is-splited custom-badge">\n                                        <span class="is-dark">count</span>\n                                        <span class="${land.apiary?"is-primary":"is-error"}">${land.apiary}</span>\n                                    </a>\n                                    <img class="img-table ${land.apiary?"":"grayscale"}" src="src/img/apiary.png" />\n                                </td>\n                                <td>\n                                    <a href="#" class="nes-badge is-splited custom-badge">\n                                        <span class="is-dark">count</span>\n                                        <span class="${land.soil?"is-primary":"is-error"}">${land.soil}</span>\n                                    </a>\n                                    <img class="img-table ${land.soil?"":"grayscale"}" src="src/img/farming.png" />\n                                </td>\n                            </tr>\n                        </tbody>\n                        <thead>\n                            <tr>\n                                <th>Forestry</th>\n                                <th>Mining</th>\n                                <th>Slugger</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            <tr>\n                                <td>\n                                    <a href="#" class="nes-badge is-splited custom-badge">\n                                        <span class="is-dark">have</span>\n                                        <span class="${land.trees?"is-success":"is-error"}">${land.trees}</span>\n                                    </a>\n                                    <img class="img-table ${land.trees?"":"grayscale"}" src="src/img/forestry.png" />\n                                </td>\n                                <td>\n                                    <a href="#" class="nes-badge is-splited custom-badge">\n                                        <span class="is-dark">have</span>\n                                        <span class="${land.mine?"is-success":"is-error"}">${land.mine?"Yes":"No"}</span>\n                                    </a>\n                                    <img class="img-table ${land.mine?"":"grayscale"}" src="src/img/mine.png" />\n                                </td>\n                                <td>\n                                    <a href="#" class="nes-badge is-splited custom-badge">\n                                        <span class="is-dark">have</span>\n                                        <span class="${land.sluggery?"is-success":"is-error"}">${land.sluggery?"Yes":"No"}</span>\n                                    </a>\n                                    <img class="img-table ${land.sluggery?"":"grayscale"}" src="src/img/slugger.png" />\n                                </td>\n                            </tr>\n                        </tbody>\n                    </table>\n                    <br />\n                    <hr />\n                    <div id="footerLand-${title}" class="footer-btn">\n                        <span class="land-footer-info"> \n                            This lands is ${land.is_open?"open":"closed"} \n                            <i class="fa ${land.is_open?"fa-unlock":"fa-lock"}" aria-hidden="true"></i>\n                        </span>\n\x3c!--                        <button id="saveLand" type="button" onclick="saveLand(${JSON.stringify(land)})" class="nes-btn is-success">A침adir a la lista</button>--\x3e\n                    </div>\n                </div>`}prevLandsTab.innerHTML=createLandContent(data.prevLand,"Prev");currentLandsTab.innerHTML=createLandContent(data.land,"Land");nextLandsTab.innerHTML=createLandContent(data.nextLand,"Next")}function renderSaveBtn(data){data=JSON.parse(data);function createButton(landData,footerId){const footer=document.getElementById(footerId);if(footer&&landData.is_open){const landButton=document.createElement("button");landButton.type="button";landButton.textContent="A침adir a la lista";landButton.classList="nes-btn is-success";landButton.onclick=function(){saveLand(landData)};footer.appendChild(landButton)}}createButton(data.prevLand,"footerLand-Prev");createButton(data.land,"footerLand-Land");createButton(data.nextLand,"footerLand-Next")}function saveLand(land){window.addDataToDB(land);renderSchedulerLand(land);setTimeout((function(){document.getElementById("box2").click()}),300)}function renderSchedulerLand(land){const container=document.createElement("div");container.className="nes-container is-rounded";container.id=land._id;const title=document.createElement("h2");title.className="title";title.textContent=`Land: ${land.number}`;container.appendChild(title);const closeButton=document.createElement("button");closeButton.className="nes-btn is-error close-btn disable";closeButton.textContent="X";closeButton.onclick=function(){deleteDataFromDB("_id",land._id)};container.appendChild(closeButton);const table=document.createElement("table");table.className="nes-table is-bordered is-centered table-centered";table.innerHTML=`\n        <thead>\n            <tr>\n                <th id="${land.number}-time-coop">00:00</th>\n                <th id="${land.number}-time-apiary">00:00</th>\n                <th id="${land.number}-time-mine">00:00</th>\n                <th id="${land.number}-time-sluggery">00:00</th>\n            </tr>\n        </thead>\n        <tbody>\n            <tr>\n                <td>\n                    <button  onclick="startCountdown('${land.number}-time-coop', this.dataset.time,  {landNumber: ${land.number}, activity: 'coop'})" id="${land.number}-btn-coop" ${land.coop?"":"disabled"} class="nes-btn land-btn  ${land.coop?"btn-success":"grayscale  is-disabled"}" data-time="3600"><img class="img-table-clock" src="src/img/skills_icon_aviculture.png" /></button>\n                </td>\n                <td>\n                    <button onclick="startCountdown('${land.number}-time-apiary', this.dataset.time,  {landNumber: ${land.number}, activity: 'apiary'})"  id="${land.number}-btn-apiary" ${land.apiary>0?"":"disabled"} class="nes-btn land-btn  ${land.apiary>0?"btn-success":"grayscale btn- is-disabled"}" data-time="7"><img class="img-table-clock" src="src/img/skills_icon_beekeeping.png" /></button>\n                </td>\n                <td>\n                    <button onclick="startCountdown('${land.number}-time-mine', this.dataset.time,  {landNumber: ${land.number}, activity: 'mine'})"  id="${land.number}-btn-mine" ${land.mine>0?"":"disabled"} class="nes-btn land-btn  ${land.mine>0?"btn-success":"grayscale btn- is-disabled"}" data-time="7200"><img class="img-table-clock" src="src/img/skills_icon_mining.png" /></button>\n                </td>\n                <td>\n                    <button onclick="startCountdown('${land.number}-time-sluggery', this.dataset.time,  {landNumber: ${land.number}, activity: 'sluggery'})"  id="${land.number}-btn-sluggery" ${land.sluggery>0?"":"disabled"} class="nes-btn land-btn  ${land.sluggery>0?"btn-success":"grayscale btn- is-disabled"}"  data-time="3600"><img class="img-table-clock" src="src/img/skills_icon_slugger.png" /></button>\n                </td>\n            </tr>\n        </tbody>`;container.appendChild(table);document.getElementById("box2").appendChild(container)}function startCountdown(elementId,totalTime,content){let timeLeft=totalTime;let element=document.getElementById(elementId);element.innerText=formatTime(timeLeft);let timer=setInterval((function(){timeLeft--;element.innerText=formatTime(timeLeft);if(timeLeft<=0){if(audio){audio.pause();audio.currentTime=0}clearInterval(timer);element.innerText="00:00";playSound();let modalContent=document.getElementById("modal-content");modalContent.innerHTML+=`<p><strong>Land ${content.landNumber}</strong> has finished the activity <strong><img class="img-modal" src="${imgSkills[content.activity]}"> ${content.activity}</strong></p>`;document.getElementById("dialog-rounded").showModal()}}),1e3)}function formatTime(seconds){let minutes=Math.floor(seconds/60);let remainingSeconds=seconds%60;return`${minutes.toString().padStart(2,"0")}:${remainingSeconds.toString().padStart(2,"0")}`}function playSound(){let soundURL="./src/sound/Joshua_McLean-Mountain-Trials.mp3";audio=new Audio(soundURL);audio.loop=true;audio.play()}function stopSound(){if(audio){audio.pause();audio.currentTime=0}}